{% extends "layout.html.jinja" %}

{% block script %}
    <script src="https://cdn.socket.io/3.1.1/socket.io.min.js"
            integrity="sha384-gDaozqUvc4HTgo8iZjwth73C6dDDeOJsAgpxBcMpZYztUfjHXpzrpdrHRdVp8ySO"
            crossorigin="anonymous"></script>
    <script type="module">
     document.getElementById('task-wrapper').scrollTo(0, 0)
     window.scrollTo(0, 0)

     import { Task } from '/{{ expert_js }}/task.js'

     const exper = '{{ exper }}'
     const sid = '{{ sid }}'
     //const urlPrefix = '{{ expert_url_prefix }}'
     //const expertStatic = `${urlPrefix}/static`
     //const expertJs = `${expertStatic}/js`

     const task = new Task(
         {{ 'true' if _debug is defined else 'false' }})

     {% if task_script is defined %}
         {% if task_script.startswith('_') %}
             {% set jspath = expert_js %}
             {% set task_script = task_script[1:] %}
         {% else %}
             {% set jspath = expert_url_prefix + '/' + exper + '/js' %}
         {% endif %}
         try {
             const mod = await import(
                 '/{{ jspath }}/task_{{ task_script }}.js')
             task.init(mod.initTask)
         } catch (error) {
             console.log('error importing script:', error)
         }
     {% else %}
         task.init(() => task.enableNext())
     {% endif %}
    </script>
{% endblock %}

{% block page_content %}
    <div id="task-wrapper">
        {% block task_content %}{% endblock %}
    </div>
    <div id="chin">
        <div id="next-btn-wrapper">
            <button type="button" id="next-btn" disabled>
                Next
                <img
                    src="/{{ expert_url_prefix }}/static/images/right_arrow.svg">
            </button>
        </div>
        <div id="debug-panel" class="{{ '' if expert_debug else 'hidden' }}">
            <div id="debug-back-btn-wrapper">
                <button type="button" id="debug-back-btn">Back</button>
            </div>
            <div id="debug-task-cursor">{{ task_cursor }}</div>
            <div id="debug-fwd-btn-wrapper">
                <button type="button" id="debug-fwd-btn">Fwd</button>
            </div>
        </div>
    </div>
{% endblock %}
